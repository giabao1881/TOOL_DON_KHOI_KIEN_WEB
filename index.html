<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <title>Tool tạo đơn khởi kiện (GitHub Pages)</title>
  <style>
    body { 
      font-family: Arial, sans-serif; 
      max-width: 900px; 
      margin: 20px auto; 
      line-height: 1.4;
    }
    h1 { text-align: center; }
    fieldset { margin-bottom: 16px; }
    label { display: block; margin-top: 6px; }
    input, select, textarea { width: 100%; padding: 4px; box-sizing: border-box; }
    button { margin-top: 12px; padding: 8px 16px; }
  </style>
</head>
<body>
  <h1>TOOL TẠO ĐƠN KHỞI KIỆN (WEB)</h1>

  <fieldset>
    <legend><strong>Thông tin bị đơn</strong></legend>
    <label>Họ tên bị đơn:
      <input id="tenBiDon" />
    </label>
    <label>Năm sinh:
      <input id="namSinh" />
    </label>
    <label>Số CMND/CCCD:
      <input id="soCCCD" />
    </label>
    <label>Nơi cấp:
      <input id="noiCap" />
    </label>
    <label>Địa chỉ:
      <textarea id="diaChi" rows="2"></textarea>
    </label>
    <label>Số điện thoại:
      <input id="dienThoai" />
    </label>
    <label>Ngày vi phạm nghĩa vụ thanh toán:
      <input id="ngayViPham" placeholder="ví dụ: 10/05/2023" />
    </label>
    <label>Ngày tính nợ:
      <input id="ngayTinhNo" placeholder="ví dụ: 20/11/2025" />
    </label>
  </fieldset>

  <fieldset>
    <legend><strong>Thông tin HỢP ĐỒNG (1 hợp đồng)</strong></legend>
    <label>Loại hợp đồng:
      <select id="loaiHD">
        <option value="LD">LD (vay tiền mặt)</option>
        <option value="THE">Thẻ tín dụng</option>
        <option value="PDPD">PDPD</option>
      </select>
    </label>
    <label>Tiêu đề hợp đồng (ví dụ: Giấy đăng ký kiêm hợp đồng cho vay không TSBD, mở &amp; sử dụng...):
      <textarea id="tieuDeHD" rows="2"></textarea>
    </label>
    <label>Số hợp đồng (nếu có):
      <input id="soHD" />
    </label>
    <label>Ngày ký (nếu cần):
      <input id="ngayHD" placeholder="08/12/2023" />
    </label>
    <label>Số tiền cho vay / hạn mức:
      <input id="soTienVay" placeholder="30000000" />
    </label>
    <label>Mục đích vay:
      <textarea id="mucDichVay" rows="2"></textarea>
    </label>
    <label>Thời hạn vay:
      <input id="thoiHanVay" placeholder="48 tháng" />
    </label>
    <label>Mô tả lãi suất (ghi đúng câu tiếng Việt bạn muốn):
      <textarea id="laiSuatMoTa" rows="2" placeholder="Ví dụ: 23%/năm được cố định đến kỳ điều chỉnh lãi suất gần nhất, sau đó định kỳ điều chỉnh 03 tháng/01 lần (+) biên độ 18%/năm."></textarea>
    </label>
    <label>Dư nợ gốc (tới ngày tính nợ):
      <input id="noGoc" placeholder="27042271" />
    </label>
    <label>Dư nợ lãi (tới ngày tính nợ):
      <input id="noLai" placeholder="32070580" />
    </label>
  </fieldset>

  <button onclick="taoDon()">Tạo đơn Word</button>

  <script>
    // format số có dấu phẩy
    function formatMoney(v) {
      v = (v || '').toString().replace(/[^\d\-]/g, '');
      if (!v) return '';
      const n = Number(v);
      return n.toLocaleString('vi-VN');
    }

    function escapeHtml(text) {
      return text
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;");
    }

    function taoDon() {
      const tenBiDon   = document.getElementById('tenBiDon').value.trim();
      if (!tenBiDon) {
        alert('Bạn phải nhập tên bị đơn.');
        return;
      }

      const namSinh    = document.getElementById('namSinh').value.trim();
      const soCCCD     = document.getElementById('soCCCD').value.trim();
      const noiCap     = document.getElementById('noiCap').value.trim();
      const diaChi     = document.getElementById('diaChi').value.trim();
      const dienThoai  = document.getElementById('dienThoai').value.trim();
      const ngayViPham = document.getElementById('ngayViPham').value.trim();
      const ngayTinhNo = document.getElementById('ngayTinhNo').value.trim();

      const loaiHD     = document.getElementById('loaiHD').value;
      const tieuDeHD   = document.getElementById('tieuDeHD').value.trim();
      const soHD       = document.getElementById('soHD').value.trim();
      const ngayHD     = document.getElementById('ngayHD').value.trim();
      const soTienVay  = formatMoney(document.getElementById('soTienVay').value);
      const mucDichVay = document.getElementById('mucDichVay').value.trim();
      const thoiHanVay = document.getElementById('thoiHanVay').value.trim();
      const laiSuatMoTa= document.getElementById('laiSuatMoTa').value.trim();
      const noGoc      = formatMoney(document.getElementById('noGoc').value);
      const noLai      = formatMoney(document.getElementById('noLai').value);
      const tongNo     = (Number(noGoc.replace(/\./g,'')) || 0) + (Number(noLai.replace(/\./g,'')) || 0);

      // Chọn nhãn theo loại HĐ
      let nhanSoTien = "Số tiền cho vay";
      let nhanThoiHan = "Thời hạn vay";
      if (loaiHD === "THE") {
        nhanSoTien = "Hạn mức tín dụng";
        nhanThoiHan = "Thời hạn sử dụng thẻ";
      }

      const tongNoFmt = tongNo ? tongNo.toLocaleString('vi-VN') : "";

      // HTML kiểu Word hiểu được
      const html =
        "<html xmlns:o='urn:schemas-microsoft-com:office:office' " +
        "xmlns:w='urn:schemas-microsoft-com:office:word' " +
        "xmlns='http://www.w3.org/TR/REC-html40'>" +
        "<head><meta charset='utf-8'><title>Đơn khởi kiện</title></head><body>" +

        "<p style='text-align:center; font-weight:bold; font-size:16pt'>ĐƠN KHỞI KIỆN</p>" +
        "<p style='text-align:center;'>V/v: Tranh chấp hợp đồng tín dụng</p><br/>" +

        "<p><b>Nguyên đơn:</b> Ngân hàng TMCP Việt Nam Thịnh Vượng (VPBank).</p>" +
        "<p><b>Bị đơn:</b> " + escapeHtml(tenBiDon) + " - Năm sinh: " + escapeHtml(namSinh) + ".</p>" +
        "<p>CMND/CCCD số " + escapeHtml(soCCCD) + " do " + escapeHtml(noiCap) + " cấp.</p>" +
        "<p>Địa chỉ: " + escapeHtml(diaChi) + "</p>" +
        "<p>Số điện thoại: " + escapeHtml(dienThoai) + "</p>" +
        "<br/>" +

        (ngayViPham ? ("<p>Từ ngày " + escapeHtml(ngayViPham) +
        " ông/bà " + escapeHtml(tenBiDon) +
        " đã vi phạm nghĩa vụ thanh toán nợ vay cho VPBank.</p>") : "") +

        "<br/><p><b>1. Hợp đồng tín dụng, cụ thể:</b></p>" +
        "<p>- " + escapeHtml(tieuDeHD) +
        (soHD ? (" số " + escapeHtml(soHD)) : "") +
        (ngayHD ? (" ngày " + escapeHtml(ngayHD)) : "") +
        ".</p>" +
        "<p>- " + nhanSoTien + ": " + escapeHtml(soTienVay) + " đồng.</p>" +
        "<p>- Mục đích vay: " + escapeHtml(mucDichVay) + ".</p>" +
        "<p>- " + nhanThoiHan + ": " + escapeHtml(thoiHanVay) + ".</p>" +
        (laiSuatMoTa ? ("<p>- Lãi suất cho vay tại thời điểm giải ngân: " +
        escapeHtml(laiSuatMoTa) + "</p>") : "") +

        (ngayTinhNo ? ("<p>Dư nợ thực tế tạm tính đến ngày " +
        escapeHtml(ngayTinhNo) + " theo hợp đồng cho vay trên là:</p>") : "<p>Dư nợ thực tế theo hợp đồng cho vay trên là:</p>") +

        "<p style='margin-left:40px'>- Nợ gốc: " + escapeHtml(noGoc) + " đồng.</p>" +
        "<p style='margin-left:40px'>- Nợ lãi: " + escapeHtml(noLai) + " đồng.</p>" +
        "<p style='margin-left:40px'><b>Tổng cộng: " + escapeHtml(tongNoFmt) + " đồng.</b></p>" +

        "<br/><p>Những nội dung trên là đúng sự thật, kính đề nghị Quý Tòa xem xét giải quyết./.</p>" +

        "</body></html>";

      const blob = new Blob([html], { type: "application/msword" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "ĐKK_" + tenBiDon.replace(/\s+/g, "_") + ".doc";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>
